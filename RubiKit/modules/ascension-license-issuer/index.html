<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ascension License Issuer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="card">
    <h1>🔐 Ascension License Issuer</h1>
    <p class="subtitle">Generate offline RSA-signed licenses for your Ascension plugin</p>

    <!-- STEP 1: SETUP -->
    <section class="section">
      <h2>📋 Step 1: First-Time Setup</h2>
      <details open>
        <summary>Click here for setup instructions (one-time only)</summary>
        <div class="instructions">
          <ol class="howto">
            <li><strong>Generate your keypair:</strong> Click "Generate New RSA Keypair" below. This creates a unique private/public key pair in your browser.</li>
            <li><strong>Save your private key:</strong> Click "Export Private Key" to download it. Keep this file SECURE - it's needed to generate licenses!</li>
            <li><strong>Copy the public key:</strong> Click "Copy Public Key (XML)" and paste it into your plugin's <code>Ascension.cs</code> file, replacing the <code>PublicKeyXml</code> constant.</li>
            <li><strong>Rebuild your plugin:</strong> Compile the plugin with the new public key so it can verify licenses.</li>
            <li><strong>Done!</strong> You can now generate licenses for any character, anytime.</li>
          </ol>
          <div class="warning">
            ⚠️ <strong>Security Note:</strong> Never share your private key! Only the public key goes in the plugin. The private key stays with you to sign licenses.
          </div>
        </div>
      </details>
    </section>

    <!-- STEP 2: KEY MANAGEMENT -->
    <section class="section">
      <h2>🔑 Step 2: Key Management</h2>

      <div class="row">
        <button id="genRsa" class="btn-primary">🎲 Generate New RSA Keypair (2048)</button>
      </div>

      <div id="keystatus" class="status">No key loaded. Generate a new keypair or import an existing one below.</div>

      <details>
        <summary>Advanced: Import existing private key</summary>
        <div class="row" style="margin-top: 12px;">
          <textarea id="privXml" rows="6"
            placeholder="Paste your PRIVATE KEY XML here (includes D, P, Q, etc.) and click Import below."
            title="Paste the full private key XML"></textarea>
        </div>
        <div class="row">
          <button id="importPrivXml">Import Private Key (XML)</button>
          <label>
            <input type="checkbox" id="remember" checked /> Remember in this browser
          </label>
        </div>
      </details>

      <h3 style="margin-top: 20px;">Public Key (for plugin)</h3>
      <div class="row">
        <textarea id="pubXmlOut" rows="3" readonly
          placeholder="Public key will appear here. Copy this to your plugin's PublicKeyXml constant."></textarea>
      </div>
      <div class="row">
        <button id="copyPubXml">📋 Copy Public Key (XML)</button>
        <button id="exportPubXml">💾 Export Public Key</button>
        <button id="exportPrivXml">🔒 Export Private Key</button>
      </div>
    </section>

    <!-- STEP 3: GENERATE LICENSE -->
    <section class="section">
      <h2>✨ Step 3: Generate License</h2>

      <div class="row">
        <label>Character Name</label>
        <input id="character" type="text" placeholder="Enter exact character name" 
               title="Enter the exact in-game character name (case-sensitive)" />
      </div>

      <div class="row">
        <label>Expiration Date</label>
        <input id="expDate" type="date" title="License will expire at midnight UTC on this date" />
      </div>

      <div class="row">
        <label>Features (optional)</label>
        <input id="features" type="text" placeholder="e.g., premium, beta-access" 
               title="Optional feature flags for the license" />
      </div>

      <div class="row">
        <button id="issue" class="btn-primary">🎫 Generate License</button>
        <button id="clear">🗑️ Clear</button>
      </div>

      <div id="result" class="result hidden">
        <h3>License Generated! 🎉</h3>
        <div class="result-info">
          <p><strong>Character:</strong> <span id="oChar">-</span></p>
          <p><strong>Expires:</strong> <span id="oExp">-</span></p>
        </div>
        <div class="row">
          <textarea id="token" rows="4" readonly
            placeholder="License will appear here"></textarea>
        </div>
        <div class="row">
          <button id="copy" class="btn-primary">📋 Copy License</button>
        </div>
        <div class="instructions" style="margin-top: 16px;">
          <p><strong>How to use in-game:</strong></p>
          <ol>
            <li>Copy the license above</li>
            <li>In-game, type: <code>/asc license set &lt;paste license here&gt;</code></li>
            <li>Verify with: <code>/asc status</code></li>
          </ol>
        </div>
      </div>
    </section>

    <footer>
      <p>Ascension License Issuer v2.0 • Offline RSA-SHA256 signing • Your keys never leave this browser</p>
    </footer>
  </div>

  <div id="rk-toasts" aria-live="polite" aria-atomic="true"></div>

  <script src="script.js"></script>
</body>
</html>
