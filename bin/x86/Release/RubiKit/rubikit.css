/* =======================================================
   RubiKitOS â€¢ Themes & Variables
   ======================================================= */

:root {
  --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-mono: ui-monospace, "Cascadia Mono", "Segoe UI Mono", "Roboto Mono", "Oxygen Mono", "Ubuntu Monospace", "Source Code Pro", "Fira Mono", "Droid Sans Mono", "Courier New", monospace;

  --radius: 6px;
  --trans: 0.15s ease;
  --shadow-ui: 0 10px 30px rgba(0,0,0,0.3);

  --text-scale: 1;
  --icon-scale: 1;
  --card-scale: calc( (var(--text-scale) + var(--icon-scale)) * 0.5 );
}

/* --- Theme Palettes --- */
body, body[data-theme="inferno"] {
  --acc: #ff6a00;
  --acc-glow: rgba(255, 106, 0, 0.4);
  --bg-0: #0a0a0c; --bg-1: #111113; --bg-2: #1a1a1e; --bg-3: #222226;
  --text: #e1e1e6; --text-dim: #9999a1; --text-mute: #6f6f78;
  --line: #2c2c33; --line-heavy: #3d3d45;
  color-scheme: dark;
}
body[data-theme="notum-blue"] {
  --acc: #0091ff;
  --acc-glow: rgba(0, 145, 255, 0.4);
  --bg-0: #0d1117; --bg-1: #161b22; --bg-2: #21262d; --bg-3: #292e36;
  --text: #c9d1d9; --text-dim: #8b949e; --text-mute: #586069;
  --line: #30363d; --line-heavy: #484f58;
  color-scheme: dark;
}
body[data-theme="terminal"] {
  --acc: #00ff41;
  --acc-glow: rgba(0, 255, 65, 0.3);
  --bg-0: #050a05; --bg-1: #0a140a; --bg-2: #101c10; --bg-3: #182918;
  --text: #00ff41; --text-dim: #00c231; --text-mute: #008521;
  --line: #174517; --line-heavy: #216321;
  color-scheme: dark;
}
body[data-theme="paper"] {
  --acc: #d94f00;
  --acc-glow: rgba(217, 79, 0, 0.4);
  --bg-0: #f4f1eb; --bg-1: #ffffff; --bg-2: #f0eeea; --bg-3: #e8e6e1;
  --text: #1f1d1a; --text-dim: #5c5955; --text-mute: #8e8a85;
  --line: #dcd9d3; --line-heavy: #c4c1bc;
  color-scheme: light;
}
body[data-theme="monokai"] {
  --acc: #ff6188;
  --acc-glow: rgba(255, 97, 136, 0.4);
  --bg-0: #1e1f21; --bg-1: #2d2e30; --bg-2: #3a3b3d; --bg-3: #47484a;
  --text: #fcfcfa; --text-dim: #a9a8a7; --text-mute: #727170;
  --line: #4a4b4d; --line-heavy: #5e5f61;
  color-scheme: dark;
}

/* =======================================================
   Base & Resets
   ======================================================= */
* { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: calc(16px * var(--text-scale)); }
body {
  font-family: var(--font-sans);
  color: var(--text);
  background: var(--bg-0);
  overflow: hidden;
  letter-spacing: 0.2px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
:focus-visible { outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px; }
.muted { color: var(--text-mute); }

/* =======================================================
   Buttons & Inputs
   ======================================================= */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
  font-size: 0.9rem; font-weight: 600;
  padding: 0.4rem 0.8rem;
  border-radius: var(--radius);
  border: 1px solid var(--line);
  background: var(--bg-1);
  color: var(--text);
  cursor: pointer;
  transition: background var(--trans), border-color var(--trans), transform var(--trans), box-shadow var(--trans);
  user-select: none;
}
.btn:hover { background: var(--bg-2); border-color: var(--line-heavy); }
.btn:active { background: var(--bg-3); transform: translateY(1px); }
.btn:disabled { opacity: 0.4; cursor: not-allowed; }
.btn-ghost { background: transparent; border-color: transparent; }
.btn-ghost:hover { background: var(--bg-2); border-color: var(--line); }
.btn.sm { font-size: 0.8rem; padding: 0.2rem 0.5rem; }
.btn svg { 
  width: calc(16px * var(--icon-scale));
  height: calc(16px * var(--icon-scale));
}
.btn-danger { background: var(--bg-3); border-color: var(--acc); color: var(--acc); }
.btn-danger:hover { background: var(--acc); border-color: var(--acc); color: var(--bg-0); }
.btn-accent { background: var(--acc); border-color: var(--acc); color: var(--bg-0); }
.btn-accent:hover { filter: saturate(1.2) brightness(1.05); }

/* =======================================================
   Taskbar
   ======================================================= */
.taskbar {
  position: fixed; inset: 0 auto auto 0; right: 0; height: 48px; z-index: 900;
  display: flex; align-items: stretch; padding: 0 1rem;
  background: color-mix(in srgb, var(--bg-1) 85%, transparent);
  border-bottom: 1px solid var(--line);
  backdrop-filter: blur(12px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.taskbar-left, .taskbar-right { display: flex; align-items: center; gap: .25rem; padding: 0 .5rem; }

/* TAB STRIP */
.taskbar-modules {
  flex: 1; display: flex; align-items: flex-end; gap: .25rem;
  overflow-x: auto; overflow-y: hidden;
}
.taskbar-modules button {
  display: inline-flex; align-items: center; gap: .5rem;
  height: 36px; margin-top: 6px;
  padding: 0 0.6rem 0 0.6rem;
  background: var(--bg-1);
  color: var(--text-dim);
  border: 1px solid var(--line);
  border-bottom: 2px solid transparent;
  border-top-left-radius: 8px; border-top-right-radius: 8px;
  transition: background var(--trans), color var(--trans), border-color var(--trans);
}
.taskbar-modules button:hover { background: var(--bg-2); color: var(--text); border-color: var(--line-heavy); }
.taskbar-modules button.active {
  background: var(--bg-2); color: var(--text);
  border-color: var(--line-heavy);
  border-bottom-color: var(--acc);
}

/* Tab content pieces */
.tab-ico {
  display: grid; place-items: center; flex-shrink: 0;
  width: calc(18px * var(--icon-scale));
  height: calc(18px * var(--icon-scale));
  overflow: hidden;
}
.tab-ico img, .tab-ico svg {
  width: 100%;
  height: 100%;
  max-width: calc(18px * var(--icon-scale));
  max-height: calc(18px * var(--icon-scale));
  object-fit: contain;
  aspect-ratio: 1 / 1;
}
.tab-name { display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; }

.tab-close {
  display: grid; place-items: center;
  width: 18px; height: 18px;
  margin-left: .35rem;
  border-radius: 4px;
  background: transparent; border: 1px solid transparent;
  color: var(--text-dim);
  line-height: 16px; font-weight: 700; cursor: pointer;
  flex-shrink: 0;
}
.tab-close:hover {
  background: var(--bg-3);
  border-color: var(--line);
  color: var(--acc);
}

/* =======================================================
   Home & Module Grid
   ======================================================= */
.home {
  position: absolute; top: 48px; bottom: 0; left: 0; right: 0;
  display: flex; flex-direction: column;
  background-color: var(--bg-0); isolation: isolate; overflow: hidden;
}

/* Desktop Effects */
@keyframes aurora-pan { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
@keyframes breathe { 0% { opacity: 0; transform: scale(0.6); } 50% { opacity: var(--effect-opacity, 0.1); } 100% { opacity: 0; transform: scale(1.2); } }
@keyframes scanline-move { from { transform: translateY(-10vh); } to { transform: translateY(110vh); } }

.home[data-effect="aurora"] {
  background: linear-gradient(270deg, var(--bg-0), color-mix(in srgb, var(--bg-0) 50%, var(--bg-1)), var(--bg-0));
  background-size: 400% 400%;
  animation: aurora-pan var(--effect-duration, 20s) ease-in-out infinite;
}
.home[data-effect="breathe"]::after {
  content: ''; position: absolute; inset: -50vmax;
  background: radial-gradient(circle at center, var(--acc), transparent 40%);
  animation: breathe var(--effect-duration, 10s) ease-in-out infinite;
  pointer-events: none;
}
.home[data-effect="scanline"]::after {
  content: ''; position: absolute; left: 0; right: 0; top: 0;
  height: 10vh;
  background: linear-gradient(to bottom, transparent 0%, color-mix(in srgb, var(--acc) 100%, transparent) 50%, transparent 100%);
  animation: scanline-move var(--effect-duration, 10s) linear infinite;
  opacity: var(--effect-opacity, 0.1); will-change: transform;
  pointer-events: none;
}

/* Ensure the decorative watermark never blocks clicks */
.home::before {
  content: ''; position: absolute; z-index: -1; inset: 0;
  background-image: url('data:image/svg+xml;utf8,<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 2L6 19L19 58L45 58L58 19L32 2Z" stroke="%231a1a1e" stroke-width="2"/><path d="M32 34L13 24L32 12L51 24L32 34Z" fill="%231a1a1e"/></svg>');
  background-repeat: no-repeat; background-position: center; background-size: 300px;
  opacity: 0.2;
  pointer-events: none;
}

/* Make the topbar sit above animated layers just in case */
.topbar {
  position: relative;
  z-index: 1;
  padding: 0.75rem 1.5rem; display: flex; align-items: center; justify-content: space-between;
  border-bottom: 1px solid var(--line);
  background: color-mix(in srgb, var(--bg-1) 50%, transparent);
  backdrop-filter: blur(8px); flex-shrink: 0;
}
.topbar .brand { display: flex; align-items: baseline; gap: 1rem; }
.topbar .actions { display: flex; align-items: center; gap: 0.75rem; }
.grid { flex: 1; overflow: auto; padding: 1.5rem; }

.chip-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(calc(200px * var(--card-scale)), 1fr));
  gap: calc(1.0rem * var(--card-scale));
}
.pane-hello {
  color: var(--text-dim); text-align: center;
  display: flex; align-items: center; justify-content: center;
  height: 100%; font-size: 1.2rem;
}

/* Module cards (scaled) */
.chip {
  display: flex; flex-direction: row; align-items: center; justify-content: flex-start;
  gap: calc(0.9rem * var(--card-scale));
  text-align: left;
  min-height: calc(68px * var(--card-scale));
  padding: calc(0.9rem * var(--card-scale));
  cursor: pointer;
  background: var(--bg-1);
  border: 2px outset var(--line-heavy);
  border-radius: var(--radius); color: var(--text);
  box-shadow: 4px 4px 0 var(--bg-0);
  transition: all var(--trans);
}
.chip:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0 var(--bg-0); border-color: var(--acc); }
.chip.active, .chip:focus-visible { border-color: var(--acc); box-shadow: 0 0 0 3px var(--acc-glow), 4px 4px 0 var(--bg-0); }
.chip .ico {
  --size: calc(34px * var(--card-scale));
  width: var(--size); height: var(--size);
  font-size: var(--size); line-height: 1; flex-shrink: 0;
}
.chip .ico img { width: 100%; height: 100%; }
.chip .name { font-weight: 600; font-size: 1rem; }

/* =======================================================
   Workspace & Console
   ======================================================= */
.workspace { position: absolute; top: 48px; bottom: 0; left: 0; right: 0; background: var(--bg-0); padding: 1rem; }
.workframe {
  position: absolute; top: 1rem; bottom: 1rem; left: 1rem; right: 1rem;
  width: calc(100% - 2rem); height: calc(100% - 2rem);
  border: 1px solid var(--line); background: #fff;
  border-radius: var(--radius); box-shadow: var(--shadow-ui);
}
.dock {
  position: fixed; left: 1rem; right: 1rem; bottom: 1rem; max-height: 40%;
  background: var(--bg-1); border: 1px solid var(--line);
  border-top: 2px solid var(--acc); border-radius: var(--radius);
  display: flex; flex-direction: column; z-index: 950; box-shadow: var(--shadow-ui);
}
.dock-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.5rem 0.8rem; border-bottom: 1px solid var(--line);
  flex-shrink: 0;
}
.dock-head strong { font-size: 0.9rem; }
.console {
  flex: 1; overflow: auto; padding: 0.5rem 0.8rem;
  font-family: var(--font-mono); font-size: 13px;
  color: color-mix(in srgb, var(--acc) 70%, var(--text));
  background: color-mix(in srgb, var(--bg-0) 80%, transparent);
}

/* =======================================================
   Side Panel
   ======================================================= */
.builder {
  position: fixed; top: 48px; right: 0; bottom: 0; width: 320px; max-width: 90vw;
  background: var(--bg-1); border-left: 1px solid var(--line);
  box-shadow: -10px 0 30px rgba(0,0,0,0.3);
  transform: translateX(100%); transition: transform .22s ease;
  z-index: 905; display: flex; flex-direction: column;
}
.builder.open { transform: translateX(0); }
.builder-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.6rem 0.8rem; border-bottom: 1px solid var(--line); flex-shrink: 0;
}
.builder-head strong { font-size: 1.1rem; }
.builder-body { display: flex; flex-direction: column; gap: .75rem; padding: 0.8rem; overflow: auto; }
.builder-row { display: flex; gap: .5rem; }
.builder-row .btn { flex: 1; }
.builder-log, .builder-out {
  font-family: var(--font-mono); font-size: 12px;
  padding: 0.6rem 0.8rem; border-radius: var(--radius);
  background: var(--bg-0); color: var(--text); border: 1px solid var(--line);
  outline: none;
}
.builder-log { flex: 0 0 100px; overflow: auto; color: var(--text-dim); }
.builder-out { flex: 1; min-height: 120px; resize: vertical; }
.builder-out:focus, .builder-log:focus { border-color: var(--acc); }

.builder-sep { height: 1px; background: var(--line); margin: 0.5rem 0; }
.builder-section-head { font-size: 0.9rem; font-weight: 600; color: var(--text-dim); margin-bottom: 0.25rem; }

/* =======================================================
   Utilities & Scrollbar
   ======================================================= */
.hidden { display: none !important; }
*::-webkit-scrollbar { width: 12px; height: 12px; }
*::-webkit-scrollbar-thumb { background: var(--bg-3); border: 3px solid transparent; border-radius: 99px; background-clip: content-box; }
*::-webkit-scrollbar-thumb:hover { background: var(--line-heavy); }
*::-webkit-scrollbar-corner { background: transparent; }
